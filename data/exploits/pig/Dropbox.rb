require 'pp'

class PigDropbox < PigParser
        def can_parse(packet)
                return false if not packet.is_eth?
                return false if not packet.is_udp?
		return false if packet.udp_src != 17500 and packet.udp_dst != 17500
                return true
        end


	def register_rules
		self.rules = {
			:eth => { :dst_mac => "ff:ff:ff:ff:ff:ff" },
			:udp => { :src_port => 17500, :dst_port => 17500},
		}
	end

	def parse(pkt)
		retun if not can_parse(pkt)
		
		payload = pkt.payload
		return if not payload

		msg = {}
        	dropbox = JSON.parse(payload )
		print_status("Dropbox Host: #{pkt.ip_saddr}")
		report_note( :host  => pkt.ip_saddr,
                	:type  => "passive.dropbox",
                	:port => 17500,
                	:proto => "udp",
                	:data => dropbox)

								
	end # end of parse
end

